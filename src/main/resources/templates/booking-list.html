<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{fragments/layout :: layout(pageTitle='예약 목록',
      content=~{::main})}">

<main class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="bi bi-calendar-check-fill"></i> 예약 관리</h2>
        <a href="/bookings/new" class="btn btn-success"><i class="bi bi-calendar-plus-fill"></i> 신규 예약 등록</a>
    </div>

    <div th:if="${#lists.isEmpty(bookings)}" class="alert alert-info text-center">
        예약 내역이 없습니다.
    </div>

    <table class="table table-hover align-middle" th:unless="${#lists.isEmpty(bookings)}">
        <thead class="table-dark">
        <tr>
            <th>예약ID</th>
            <th>서비스 제공자</th>
            <th>희망일시</th>
            <th>상태</th>
            <th>예약일</th>
            <th>리뷰/결제</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="b : ${bookings}">
            <td th:text="${b.id}"></td>
            <td th:text="${b.provider.providerName}"></td>
            <td th:text="${#temporals.format(b.desiredDateTime, 'yyyy-MM-dd HH:mm')}"></td>
            <td><span class="badge bg-primary" th:text="${b.status}"></span></td>
            <td class="timeago" th:title="${#temporals.formatISO(b.createdAt)}"></td>
            <td>
                <div class="btn-group">
                    <a th:if="${b.review == null and b.status.name() == 'COMPLETED'}"
                       th:href="@{|/reviews/new/${b.id}|}" class="btn btn-sm btn-warning">리뷰</a>
                    <span th:if="${b.review != null}" class="btn btn-sm btn-secondary disabled">리뷰완료</span>

                    <!-- TODO: 결제 완료 여부 확인 로직 필요 -->
                    <a th:href="@{|/payments/new/${b.id}|}" class="btn btn-sm btn-danger">결제</a>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</main>
</html>